<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>smart editor</title>
    <script src="./closure/goog/base.js"></script>
    <script src="./blockly_compressed.js"></script>
    <script src="./blocks_compressed.js"></script>
    <script src="blocks/myGenerate/basicFunction.js" charset="UTF-8"></script>
    <script src="blocks/myGenerate/fieldType.js" charset="UTF-8"></script>
    <script src="blocks/myGenerate/functionType.js" charset="UTF-8"></script>

    <script src="./msg/js/zh-hans.js"></script>
    <script src="./msg/js/en.js"></script>

    <script src="generators/solidity.js"></script>
    <script src="generators/solidity/math.js"></script>
    <script src="generators/solidity/logic.js"></script>
    <script src="generators/solidity/loops.js"></script>
    <script src="generators/myGenerate/basicFunction.js"></script>
    <script src="generators/myGenerate/fieldType.js"></script>


    <script src="./jquery-3.4.1.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/element-ui@2.15.7/lib/theme-chalk/index.css">
</head>
<body>
<div id="blocklyDiv" style="height: 850px; width: 1400px;"></div>

<p>
    <button id="link" onclick="showCode()">Show code</button>
</p>


<xml xmlns="https://developers.google.com/blockly/xml" id="toolbox" style="display: none">
    <category name="函数类型" colour="230">
        <block type="function"></block>
        <block type="construct"></block>
        <block type="event"></block>
    </category>
    <category name="基本的复用功能块" colour="165">
        <block type="set_contract_owner"></block>
        <block type="get_value"></block>
        <block type="transfer"></block>
        <block type="require"></block>
        <block type="destroy_contract"></block>
    </category>
    <category name="属性块" colour="345">
        <block type="basic_type"></block>
        <block type="special_type"></block>
        <block type="basic_type_no_name"></block>
        <block type="nest_struct"></block>
        <block type="nest_mapping_array"></block>
    </category>

    <category name="Logic" colour="%{BKY_LOGIC_HUE}">
        <category name="If">
            <block type="controls_if"></block>
            <block type="controls_if">
                <mutation else="1"></mutation>
            </block>
            <block type="controls_if">
                <mutation elseif="1" else="1"></mutation>
            </block>
        </category>
        <category name="Boolean">
            <block type="logic_compare"></block>
            <block type="logic_operation"></block>
            <block type="logic_negate"></block>
            <block type="logic_boolean"></block>
            <block type="logic_null"></block>
<!--            <block type="logic_ternary"></block>-->
        </category>
    </category>


    <category name="Loops" colour="%{BKY_LOOPS_HUE}">
        <block type="controls_repeat_ext">
            <value name="TIMES">
                <block type="math_number">
                    <field name="NUM">10</field>
                </block>
            </value>
        </block>
        <block type="controls_whileUntil"></block>
        <block type="controls_for">
            <field name="VAR">i</field>
            <value name="FROM">
                <block type="math_number">
                    <field name="NUM">1</field>
                </block>
            </value>
            <value name="TO">
                <block type="math_number">
                    <field name="NUM">10</field>
                </block>
            </value>
            <value name="BY">
                <block type="math_number">
                    <field name="NUM">1</field>
                </block>
            </value>
        </block>
<!--        <block type="controls_forEach"></block>-->
        <block type="controls_flow_statements"></block>
    </category>


    <category name="Math" colour="%{BKY_MATH_HUE}">
        <block type="math_number">
            <field name="NUM">123</field>
        </block>
        <block type="math_arithmetic"></block>
<!--        <block type="math_single"></block>-->
<!--        <block type="math_trig"></block>-->
<!--        <block type="math_constant"></block>-->
        <block type="math_number_property"></block>
<!--        <block type="math_round"></block>-->
<!--        <block type="math_on_list"></block>-->
        <block type="math_modulo"></block>
<!--        <block type="math_random_int">-->
<!--            <value name="FROM">-->
<!--                <block type="math_number">-->
<!--                    <field name="NUM">1</field>-->
<!--                </block>-->
<!--            </value>-->
<!--            <value name="TO">-->
<!--                <block type="math_number">-->
<!--                    <field name="NUM">100</field>-->
<!--                </block>-->
<!--            </value>-->
<!--        </block>-->
<!--        <block type="math_random_float"></block>-->
<!--        <block type="math_atan2"></block>-->
    </category>
    <category name="文本" colour="45">
        <block type="text"></block>
    </category>

</xml>

<script src="workspace.js"></script>
</body>


<script>
    function showCode() {

        // Generate JavaScript code and display it.
        var topBlocks = workspace.getAllBlocks();
        var codes = [];
        var contractBlock = workspace.getTopBlocks()[0];
        //console.log('contractBlock' + contractBlock.toString());
        console.log(topBlocks)
        for (var i = 0; i < topBlocks.length; i++) {
            if (topBlocks[i] == contractBlock) {
                var code = Blockly.Solidity.blockToCode(topBlocks[i]);
                codes.push(code + '\n');
            }
        }
        console.log(codes);
        alert(codes);
        // let tmp = codes[0].replace('\n', '').split('@');
        // console.log(tmp);
        // var url = 'http://localhost:9014/api/generate/code?fileIds=' + tmp[1] + '&contractName=' + tmp[0];
        // var response = sendHttpGet(url);
        // alert(response);
    }
</script>
</html>
