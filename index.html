<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>smart editor</title>
    <script src="./closure/goog/base.js"></script>
    <script src="./blockly_compressed.js"></script>
    <script src="./blocks_compressed.js"></script>
    <script src="./blocks/my_contract_entity.js" charset="UTF-8"></script>
    <script src="./blocks/basicFunction.js" charset="UTF-8"></script>
    <script src="./msg/js/zn-hans.js"></script>
    <script src="./msg/js/en.js"></script>
    <script src="./generators/generate.js"></script>
    <script src="./jquery-3.4.1.js"></script>
</head>
<body>
<div id="blocklyDiv" style="height: 850px; width: 1400px;"></div>

<p>
    <button id="link" onclick="showCode()">Show code</button>
</p>


<xml xmlns="https://developers.google.com/blockly/xml" id="toolbox" style="display: none">
<!--    <category name="合约类型">-->
<!--        <block type="contract"></block>-->
<!--        <block type="interface"></block>-->
<!--    </category>-->
<!--    <category name="文本">-->
<!--        <block type="text"></block>-->
<!--    </category>-->
<!--    <category name="是否使用继承的合约库">-->
<!--        <block type="unuse_inherit"></block>-->
<!--        <block type="use_inherit"></block>-->
<!--    </category>-->
<!--    <category name="可继承的合约库">-->
<!--        <block type="library"></block>-->
<!--    </category>-->
<!--    <category name="条款">-->
<!--        <block type="term"></block>-->
<!--    </category>-->
    <category name="Logic" colour="%{BKY_LOGIC_HUE}">
        <category name="If">
            <block type="controls_if"></block>
            <block type="controls_if">
                <mutation else="1"></mutation>
            </block>
            <block type="controls_if">
                <mutation elseif="1" else="1"></mutation>
            </block>
        </category>
        <category name="Boolean" colour="%{BKY_LOGIC_HUE}">
            <block type="logic_compare"></block>
            <block type="logic_operation"></block>
            <block type="logic_negate"></block>
            <block type="logic_boolean"></block>
            <block type="logic_null"></block>
            <block type="logic_ternary"></block>
        </category>
    </category>

    <category name="Loops" colour="%{BKY_LOOPS_HUE}">
        <block type="controls_repeat_ext">
            <value name="TIMES">
                <block type="math_number">
                    <field name="NUM">10</field>
                </block>
            </value>
        </block>
        <block type="controls_whileUntil"></block>
        <block type="controls_for">
            <field name="VAR">i</field>
            <value name="FROM">
                <block type="math_number">
                    <field name="NUM">1</field>
                </block>
            </value>
            <value name="TO">
                <block type="math_number">
                    <field name="NUM">10</field>
                </block>
            </value>
            <value name="BY">
                <block type="math_number">
                    <field name="NUM">1</field>
                </block>
            </value>
        </block>
        <block type="controls_forEach"></block>
        <block type="controls_flow_statements"></block>
    </category>

    <category name="Math" colour="%{BKY_MATH_HUE}">
        <block type="math_number">
            <field name="NUM">123</field>
        </block>
        <block type="math_arithmetic"></block>
        <block type="math_single"></block>
        <block type="math_trig"></block>
        <block type="math_constant"></block>
        <block type="math_number_property"></block>
        <block type="math_round"></block>
        <block type="math_on_list"></block>
        <block type="math_modulo"></block>
        <block type="math_constrain">
            <value name="LOW">
                <block type="math_number">
                    <field name="NUM">1</field>
                </block>
            </value>
            <value name="HIGH">
                <block type="math_number">
                    <field name="NUM">100</field>
                </block>
            </value>
        </block>
        <block type="math_random_int">
            <value name="FROM">
                <block type="math_number">
                    <field name="NUM">1</field>
                </block>
            </value>
            <value name="TO">
                <block type="math_number">
                    <field name="NUM">100</field>
                </block>
            </value>
        </block>
        <block type="math_random_float"></block>
        <block type="math_atan2"></block>
    </category>
    <category name="基本的复用功能块" colour="210">
        <block type="set_contract_owner"></block>
    </category>

</xml>

<script src="workspace.js"></script>
</body>


<script>
    function showCode() {

        // Generate JavaScript code and display it.
        var topBlocks = workspace.getAllBlocks();
        var codes = [];
        var contractBlock = workspace.getTopBlocks()[0];
        //console.log('contractBlock' + contractBlock.toString());
        console.log(topBlocks)
        for (var i = 0; i < topBlocks.length; i++) {
            if (topBlocks[i] == contractBlock) {
                var code = Blockly.codelabGenerator.blockToCode(topBlocks[i]);
                codes.push(code + '\n');
            }
        }
        console.log(codes);
        alert(codes);
        // let tmp = codes[0].replace('\n', '').split('@');
        // console.log(tmp);
        // var url = 'http://localhost:9014/api/generate/code?fileIds=' + tmp[1] + '&contractName=' + tmp[0];
        // var response = sendHttpGet(url);
        // alert(response);
    }
</script>
</html>